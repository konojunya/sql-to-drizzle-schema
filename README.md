# sql-to-drizzle-schema

[![CI/CD Pipeline](https://github.com/konojunya/sql-to-drizzle-schema/actions/workflows/ci.yaml/badge.svg)](https://github.com/konojunya/sql-to-drizzle-schema/actions/workflows/ci.yaml)
[![Go Version](https://img.shields.io/badge/go-1.24.1-blue.svg)](https://golang.org/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Release](https://img.shields.io/github/v/release/konojunya/sql-to-drizzle-schema)](https://github.com/konojunya/sql-to-drizzle-schema/releases)

A command-line tool that converts SQL DDL files to [Drizzle ORM](https://orm.drizzle.team/) schema definitions in TypeScript.

## ğŸ¯ Purpose

This tool bridges the gap between traditional SQL schema definitions and modern TypeScript ORM solutions by automatically converting CREATE TABLE statements and other DDL commands into equivalent Drizzle ORM schema code.

Perfect for:
- Migrating existing SQL schemas to Drizzle ORM
- Developers who prefer defining schemas in SQL first
- Converting legacy database schemas to modern TypeScript ORMs
- Rapid prototyping with existing SQL schemas

## âœ¨ Features

### Current Features
- ğŸ”§ **CLI Interface**: Easy-to-use command-line tool with intuitive flags
- ğŸ“ **File Reading**: Robust SQL file reading with comprehensive error handling
- ğŸ“¦ **Clean Architecture**: Well-structured Go codebase following best practices
- ğŸ“š **Comprehensive Documentation**: Detailed code comments and documentation

### Planned Features
- ğŸ” **SQL Parsing**: Parse various SQL DDL statements (CREATE TABLE, ALTER TABLE, etc.)
- ğŸ”„ **Type Conversion**: Convert SQL data types to appropriate Drizzle ORM types
- ğŸ“ **TypeScript Generation**: Generate clean TypeScript code with proper imports
- ğŸ—„ï¸ **Multi-Database Support**: Support for PostgreSQL, MySQL, and SQLite
- ğŸ”— **Relationships**: Handle foreign keys and table relationships
- ğŸ“Š **Advanced Features**: Support for indexes, constraints, and default values

## ğŸš€ Installation

### Prerequisites
- Go 1.24.1 or later

### From Source
```bash
# Clone the repository
git clone https://github.com/konojunya/sql-to-drizzle-schema.git
cd sql-to-drizzle-schema

# Build the binary
go build -o sql-to-drizzle-schema

# (Optional) Install globally
go install github.com/konojunya/sql-to-drizzle-schema@latest
```

### Using Go Install
```bash
go install github.com/konojunya/sql-to-drizzle-schema@latest
```

## ğŸ“– Usage

### Basic Usage
```bash
# Convert SQL file to Drizzle schema
./sql-to-drizzle-schema input.sql -o schema.ts

# Use default output filename (schema.ts)
./sql-to-drizzle-schema input.sql

# Get help
./sql-to-drizzle-schema --help
```

### Command-Line Options
```
Usage:
  sql-to-drizzle-schema [SQL_FILE] [flags]

Flags:
  -h, --help            help for sql-to-drizzle-schema
  -o, --output string   Output TypeScript file (default: schema.ts)
```

## ğŸ“ Examples

### Input SQL File (PostgreSQL)
```sql
-- users table
CREATE TABLE users (
  id BIGSERIAL NOT NULL,
  name VARCHAR(255) NOT NULL,
  email VARCHAR(255) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(255) NOT NULL DEFAULT 'user',
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT pk_users PRIMARY KEY (id)
);

-- posts table
CREATE TABLE posts (
  id BIGSERIAL NOT NULL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  content TEXT NOT NULL,
  user_id BIGINT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_posts_users FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### Actual Output (TypeScript)
> **Note**: This is the actual output generated by the tool.

```typescript
import { bigint, bigserial, boolean, decimal, doublePrecision, integer, pgTable, real, smallint, text, timestamp, varchar } from 'drizzle-orm/pg-core';

// users table
export const users = pgTable('users', {
  id: bigserial('id', { mode: 'number' }).notNull().primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  email: varchar('email', { length: 255 }).notNull().unique(),
  password: varchar('password', { length: 255 }).notNull(),
  role: varchar('role', { length: 255 }).notNull().default('user'),
  deletedAt: timestamp('deleted_at', { withTimezone: true }),
  createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),
  updatedAt: timestamp('updated_at', { withTimezone: true }).notNull().defaultNow()
});

// posts table
export const posts = pgTable('posts', {
  id: bigserial('id', { mode: 'number' }).notNull(),
  title: varchar('title', { length: 255 }).notNull(),
  content: text('content').notNull(),
  userId: bigint('user_id', { mode: 'number' }).notNull().references(() => users.id),
  deletedAt: timestamp('deleted_at', { withTimezone: true }),
  createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),
  updatedAt: timestamp('updated_at', { withTimezone: true }).notNull().defaultNow()
});

// comments table
export const comments = pgTable('comments', {
  id: bigserial('id', { mode: 'number' }).notNull(),
  content: text('content').notNull(),
  userId: bigint('user_id', { mode: 'number' }).notNull().references(() => users.id),
  postId: bigint('post_id', { mode: 'number' }).notNull().references(() => posts.id),
  deletedAt: timestamp('deleted_at', { withTimezone: true }),
  createdAt: timestamp('created_at', { withTimezone: true }).notNull().defaultNow(),
  updatedAt: timestamp('updated_at', { withTimezone: true }).notNull().defaultNow()
});
```

### Running the Example
```bash
# Try with the included example
./sql-to-drizzle-schema ./example/postgres/create-table.sql -o example-output.ts

# Specify dialect explicitly
./sql-to-drizzle-schema ./example/postgres/create-table.sql --dialect postgresql -o schema.ts

# View the generated schema
cat schema.ts
```

## ğŸ—ï¸ Architecture

The project follows Go best practices with a clean package structure:

```
sql-to-drizzle-schema/
â”œâ”€â”€ main.go                    # CLI entry point using Cobra
â”œâ”€â”€ internal/                  # Internal packages
â”‚   â”œâ”€â”€ reader/               # File reading utilities
â”‚   â”‚   â””â”€â”€ file.go           # SQL file reading functionality
â”‚   â”œâ”€â”€ parser/               # SQL parsing functionality
â”‚   â”‚   â”œâ”€â”€ types.go          # Type definitions for parsed SQL structures
â”‚   â”‚   â”œâ”€â”€ postgres.go       # PostgreSQL-specific parser implementation
â”‚   â”‚   â””â”€â”€ parser.go         # Parser factory and common functionality
â”‚   â””â”€â”€ generator/            # Drizzle schema generation
â”‚       â”œâ”€â”€ types.go          # Type definitions for schema generation
â”‚       â”œâ”€â”€ postgres.go       # PostgreSQL to Drizzle type mapping
â”‚       â””â”€â”€ generator.go      # Generator factory and file operations
â”œâ”€â”€ example/                  # Example SQL files
â”‚   â””â”€â”€ postgres/
â”‚       â””â”€â”€ create-table.sql  # PostgreSQL example schema
â”œâ”€â”€ doc.go                    # Package documentation
â”œâ”€â”€ CLAUDE.md                 # Development guidelines
â”œâ”€â”€ README.md                 # This file
â”œâ”€â”€ LICENSE                   # MIT License
â”œâ”€â”€ go.mod                    # Go module definition
â””â”€â”€ go.sum                    # Go dependencies
```

### Key Components
- **CLI Interface**: Built with [Cobra](https://github.com/spf13/cobra) for robust command-line handling
- **File Reader**: Handles SQL file I/O with comprehensive error handling
- **SQL Parser**: Regex-based parser for PostgreSQL CREATE TABLE statements
- **Schema Generator**: Converts parsed SQL structures to Drizzle ORM TypeScript code
- **Type Mapping**: Comprehensive mapping from PostgreSQL types to Drizzle types
- **Internal Packages**: Following Go conventions for internal-only code

## ğŸ› ï¸ Development

### Prerequisites
- Go 1.24.1 or later
- Basic understanding of SQL and TypeScript

### Building from Source
```bash
# Clone and enter the repository
git clone https://github.com/konojunya/sql-to-drizzle-schema.git
cd sql-to-drizzle-schema

# Using Makefile (recommended)
make help                    # Show all available commands
make build                   # Build the binary
make test                    # Run all tests
make test-coverage          # Run tests with coverage
make fmt                    # Format code
make lint                   # Run linter (requires golangci-lint)
make check                  # Run all checks (fmt, vet, lint, test)
make example                # Build and run with example file
make clean                  # Clean build artifacts

# Or using Go commands directly
go mod download             # Download dependencies
go build -o sql-to-drizzle-schema  # Build the project
go test ./...              # Run tests
go fmt ./...               # Format code
```

### Project Status
- âœ… CLI framework with Cobra
- âœ… File reading functionality
- âœ… Package structure and comprehensive documentation
- âœ… PostgreSQL SQL parsing (CREATE TABLE statements)
- âœ… Database dialect selection (--dialect flag)
- âœ… Drizzle ORM schema generation for PostgreSQL
- âœ… TypeScript output generation with proper imports
- âœ… Complete end-to-end conversion pipeline
- âœ… Foreign key relationships with .references() support
- âœ… Table dependency ordering for proper schema generation
- âœ… Comprehensive test suite with high coverage
- ğŸš§ MySQL parser (planned)
- ğŸš§ Spanner parser (planned)

### Testing

This project includes a comprehensive test suite with high coverage:

- **Unit Tests**: All internal packages have dedicated test files
  - `internal/reader`: 100% coverage - File reading and error handling
  - `internal/parser`: 83.7% coverage - SQL parsing and validation
  - `internal/generator`: 78.2% coverage - Schema generation and type mapping
- **Integration Tests**: End-to-end conversion pipeline testing
- **CLI Tests**: Command-line interface validation and flag testing

**Running Tests:**
```bash
# Using Makefile (recommended)
make test                   # Run all tests
make test-coverage         # Run tests with coverage
make test-coverage-view    # Run tests with coverage and open in browser
make test-verbose          # Run tests with verbose output

# Or using Go commands directly
go test ./...              # Run all tests
go test -cover ./...       # View test coverage
go test -v ./...           # Detailed test output
```

**Test Categories:**
- SQL parsing with various PostgreSQL features
- Type mapping from PostgreSQL to Drizzle ORM
- Foreign key relationship handling
- Table dependency ordering
- Naming convention transformations
- Error handling and edge cases
- File I/O operations
- CLI argument validation

### Development Guidelines
Please see [CLAUDE.md](CLAUDE.md) for detailed development guidelines, coding standards, and architectural decisions.

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit issues, feature requests, and pull requests.

### How to Contribute
1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make your changes following the coding guidelines in [CLAUDE.md](CLAUDE.md)
4. Add tests for your changes
5. Run the development workflow: `make dev` or `make check`
6. Commit your changes (`git commit -m 'Add amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Open a Pull Request

### Development Workflow
```bash
# Setup development environment
make setup

# Development cycle
make dev          # format + test + build
make check        # format + vet + lint + test

# Run specific checks
make test         # run tests
make lint         # run linter
make security     # run security scan
```

### CI/CD Pipeline
This project uses GitHub Actions for continuous integration and deployment:

- **Automated Testing**: Tests run on Linux, macOS, and Windows across multiple Go versions
- **Code Quality**: Automated linting, formatting, and security scanning
- **Cross-platform Builds**: Automatic binary generation for multiple platforms
- **Release Automation**: Automated releases with changelog generation
- **Dependency Updates**: Automated dependency updates via Dependabot

### Reporting Issues
When reporting issues, please include:
- Go version
- Operating system
- Input SQL file (if applicable)
- Expected vs actual behavior
- Steps to reproduce

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ‘¥ Authors

This project is primarily developed by **Claude (Anthropic's AI assistant)** under the direction of [konojunya](https://github.com/konojunya).

### Main Committer
- **Claude**: Primary developer responsible for code implementation, architecture design, and documentation
- **Role**: All code, documentation, and project structure development

### Project Owner
- **[konojunya](https://github.com/konojunya)**: Project owner and maintainer
- **Role**: Project direction, requirements specification, and repository management

### Development Model
This project serves as an example of AI-assisted software development, where Claude handles the complete implementation while working under human guidance and supervision.

## ğŸ™ Acknowledgments

- [Drizzle ORM](https://orm.drizzle.team/) - The excellent TypeScript ORM this tool generates code for
- [Cobra](https://github.com/spf13/cobra) - The CLI framework used for building the command-line interface
- The Go community for excellent tooling and best practices
- [Anthropic](https://www.anthropic.com/) - For developing Claude, the AI assistant that built this project

## ğŸ”— Related Projects

- [Drizzle ORM](https://github.com/drizzle-team/drizzle-orm) - TypeScript ORM for SQL databases
- [Drizzle Kit](https://github.com/drizzle-team/drizzle-kit) - CLI companion for Drizzle ORM

---

Developed by Claude (Anthropic) ğŸ¤– â€¢ Maintained by [konojunya](https://github.com/konojunya) â¤ï¸